var app=new Vue({el:"#app",data:{settings:{},content:{},schema:{},stats:[],strings:strings,polities:[],orderedStatSections:[],currentPolity:null,currentStat:null,currentLimit:null,currentFilter:"greaterThanOrEqual",currentSortDirection:"ascending",currentSortField:"name",showDebug:!1,currentView:"map",firstStatSections:["Naming","Demographics","Economy","Infrastructure"],actualStatSections:[],additionalStatSections:[]},methods:{changeSortDirection:function(){"ascending"==this.currentSortDirection?this.setSortDirection("descending"):this.setSortDirection("ascending")},changeSortField:function(){"name"==this.currentSortField?this.setSortField("value"):this.setSortField("name")},setSortField:function(t){this.currentSortField=t},setSortDirection:function(t){this.currentSortDirection=t},formatStatData:function(t,r){return"percent"==r?numeral(t).format("0[.]00%"):"currency"==r?numeral(t).format("$0,0[.]00"):"number"==r?numeral(t).format("0,0[.]00"):"polities"==r&&this.content[t]?this.content[t].name:t},politySelect:function(t){this.showPolityInfo(t)},statSelect:function(t){this.showStatsInfo(t),this.removeFilter()},removeFilter:function(){this.currentLimit=null,this.currentFilter="greaterThanOrEqual"},polityBack:function(){this.showPolitiesList()},statBack:function(){this.showStatsList()},statSelectWithLimit:function(t,r){this.currentStat==t&&this.currentLimit&&this.changeFilter(),this.showStatsInfo(t),this.applyFilter(r)},applyFilter:function(t){this.currentLimit=t},showPolitiesList:function(){this.currentPolity=null,scrollUp("#middle-left")},showStatsList:function(){this.currentStat=null,scrollUp("#middle-right")},showPolityInfo:function(t){this.currentPolity=t,scrollUp("#middle-left")},showStatsInfo:function(t){this.currentStat=t,scrollUp("#middle-right")},hideDebug:function(){this.showDebug=!1},showDebug:function(){this.showDebug=!0},sort:function(t){this.currentSort=t||"valueAscending"},changeFilter:function(){app.currentFilterIndex+1>=app.currentPossibleFilters.length?app.currentFilter=app.currentPossibleFilters[0]:app.currentFilter=app.currentPossibleFilters[app.currentFilterIndex+1]},filterStatItem:function(t){return!!this.currentStatsInfo[t]&&(null==this.currentLimit||(this.currentStatIsNumeric?!!("greaterThanOrEqual"==this.currentFilter&&this.currentStatsInfo[t]>=this.currentLimit&&this.currentLimit)||!!("lessThanOrEqual"==this.currentFilter&&this.currentStatsInfo[t]<=this.currentLimit&&this.currentLimit):"equal"==this.currentFilter&&this.currentLimit==this.currentStatsInfo[t]||"notEqual"==this.currentFilter&&this.currentLimit!=this.currentStatsInfo[t]))}},watch:{currentColors:function(){mapDisplay.updateChoropleth(this.currentColors,{reset:!0})},currentStat:function(){this.currentStat||(this.currentSortField="name",this.currentSortDirection="ascending")}},computed:{currentSort:function(){return"name"==this.currentSortField&&"ascending"==this.currentSortDirection?"nameAscending":"name"==this.currentSortField&&"descending"==this.currentSortDirection?"nameDescending":"value"==this.currentSortField&&"ascending"==this.currentSortDirection?"valueAscending":"value"==this.currentSortField&&"descending"==this.currentSortDirection?"valueDescending":"nameAscending"},sortedPolities:function(){if(this.currentSortInfo){var t=[],r=this.currentSortInfo.slice();if("valueAscending"==this.currentSort)this.currentStatIsNumeric?r.sort(function(t,r){return t[2]-r[2]}):r.sort(function(t,r){return t[2]===r[2]?0:t[2]<r[2]?-1:1});else if("valueDescending"==this.currentSort)this.currentStatIsNumeric?r.sort(function(t,r){return r[2]-t[2]}):r.sort(function(t,r){return t[2]===r[2]?0:t[2]>r[2]?-1:1});else if("nameAscending"==this.currentSort)r.sort(function(t,r){return t[1]===r[1]?0:t[1]<r[1]?-1:1});else{if("nameDescending"!=this.currentSort)return this.polities;r.sort(function(t,r){return t[1]===r[1]?0:t[1]>r[1]?-1:1})}return each(r,function(r,n){t.push(n[0])}),t}return this.polities},currentSortInfo:function(){if(this.currentStat&&this.content){var t=[];return each(this.polities,function(r,n){var e=app.content[n].name,i=app.content[n][app.currentStat];""!=i&&t.push([n,e,i])}),t}return null},currentStatType:function(){return this.schema[this.currentStat]?this.schema[this.currentStat].type:null},currentPolityInfo:function(){var t={};return this.currentPolity&&(t=this.content[this.currentPolity]),t},currentPolityInfoFormatted:function(){var t={};return each(this.currentPolityInfo,function(r,n){var e="";app.schema[r]&&(e=app.schema[r].type),t[r]=app.formatStatData(n,e)}),t},currentStatsInfo:function(){var t={};return this.currentStat&&each(this.polities,function(r,n){t[n]=app.content[n][app.currentStat]}),t},currentStatsInfoFiltered:function(){var t={};return each(this.currentStatsInfo,function(r,n){app.filterStatItem(r)&&(t[r]=n)}),t},currentStatsInfoFormatted:function(){var t={},r=this.currentStatType;return each(this.currentStatsInfo,function(n,e){t[n]=app.formatStatData(e,r)}),t},currentPolityName:function(){if(this.currentPolity)return this.currentPolityInfo.name},currentStatName:function(){if(this.schema[this.currentStat])return this.schema[this.currentStat].title},polityPaneTitle:function(){return this.currentPolity?this.currentPolityName:this.strings.polityPaneTitle},statsPaneTitle:function(){return this.currentStat?this.currentStatName:this.strings.statsPaneTitle},currentLimitFormatted:function(){return null==this.currentLimit?null:app.formatStatData(this.currentLimit,this.currentStatType)},currentStatIsNumeric:function(){return null==this.currentStatType?null:"index"==this.currentStatType||"number"==this.currentStatType||"percent"==this.currentStatType||"currency"==this.currentStatType||"rank"==this.currentStatType||("singleSelect"==this.currentStatType||"verbose"==this.currentStatType||"code"==this.currentStatType||this.currentStatType,!1)},currentPossibleFilters:function(){return this.currentStat?this.currentStatIsNumeric?["greaterThanOrEqual","lessThanOrEqual"]:this.currentStatIsNumeric?null:["equal","notEqual"]:null},currentFilterIndex:function(){return this.currentStat?this.currentPossibleFilters.indexOf(this.currentFilter):null},currentStatArray:function(){var t=[];return each(this.currentStatsInfo,function(r,n){n&&""!=n&&t.push(n)}),t},currentStatMin:function(){return this.currentStat?null!=this.schema[this.currentStat].min&&""!=this.schema[this.currentStat].min?this.schema[this.currentStat].min:Math.min.apply(null,this.currentStatArray):null},currentStatMax:function(){return this.currentStat?null!=this.schema[this.currentStat].max&&""!=this.schema[this.currentStat].max?this.schema[this.currentStat].max:Math.max.apply(null,this.currentStatArray):null},currentSourceName:function(){return this.currentStat?this.schema[this.currentStat].sourceName:null},currentSourceURL:function(){return this.currentStat?this.schema[this.currentStat].sourceURL:null},filterApplied:function(){return this.currentStat?!!this.currentLimit:null},currentColorScale:function(){var t=this.currentStatType,r=this.currentStatMin,n=this.currentStatMax;return this.currentStat?"index"==t||"number"==t||"percent"==t||"currency"==t?d3.scale.linear().domain([r,n]).range([app.settings.colors.light,app.settings.colors.dark]):"rank"==t?d3.scale.linear().domain([r,n]).range([app.settings.colors.dark,app.settings.colors.light]):"singleSelect"==t?d3.scale.category20b():"verbose"==t||"code"==t?function(){return app.settings.colors.medium}:"multipleSelect"==t?function(){return app.settings.colors.mediumDark}:d3.scale.category20b():null},currentColors:function(){return this.currentStat?(info={},each(this.currentStatsInfoFiltered,function(t,r){info[t]=app.currentColorScale(r)}),info):null}}});